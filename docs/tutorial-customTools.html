<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> customTools</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-Assistants and Threads.html">
                                Assistants and Threads
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-customTools.html">
                                customTools
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-gettingStarted.html">
                                gettingStarted
                            </a>
                        
                            <a class="dropdown-item" href="tutorial-Useful links.html">
                                Useful links
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar tutorials"
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-Assistants and Threads.html">Assistants and Threads</a></li><li><a href="tutorial-customTools.html">customTools</a></li><li><a href="tutorial-gettingStarted.html">gettingStarted</a></li><li><a href="tutorial-Useful links.html">Useful links</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Tutorial</p>
                    <h1>customTools</h1>
                </header>
                <section>

<article>
    <h1>Add custom tool to extend the Assistant</h1>
<blockquote>
<p>Set type to &quot;module&quot; in your package.json</p>
</blockquote>
<h2>Step 1: Install the library into your application</h2>
<pre class="prettyprint source lang-cmd"><code>npm install @sassoftware/viya-assistantjs
</code></pre>
<h2>Step 2: Create a simple nodejs application(assistant.js)</h2>
<p>Here is the skeleton code
This is a fully functional chat program</p>
<pre class="prettyprint source lang-javascript"><code>
import * as readline from 'node:readline/promises';
import { stdin as input, stdout as output } from 'node:process';
import {setupAssistant, runAssistant} from '@sassoftware/viya-assistantjs';

// this import is to get token and host for Viya - created with sas-viya auth login|loginCode
// replace the next two lines to suit your environment
// see this link for the getToken function
import getToken from './getToken.js'; 
let {host, token} = getToken();

// Add another tool 

// Tool specification
let customTools: [
  {
    type: 'function',
    function: {
      name: &quot;runSAS&quot;,
      description: &quot;run the specified file. The file is a path to the sas program&quot;,
      parameters: {
        properties: {
          file: {
            type: &quot;string&quot;,
            description: &quot;this is the file to run&quot;,
          },
        },
        type: &quot;object&quot;,
        required: [&quot;file&quot;],
      },
    }
  }
];

//handler for running sas code
const runSASFunctionSpec = {
  name: &quot;runSAS&quot;,
  description: &quot;run the specified file. The file is a path to the sas program&quot;,
  parameters: {
    properties: {
      file: {
        type: &quot;string&quot;,
        description: &quot;this is the file to run&quot;,
      },
    },
    type: &quot;object&quot;,
    required: [&quot;file&quot;],
  },
};

async function runSAS(params, appEnv) {
  let { file } = params;
  let { store, session } = appEnv;
  let src;
  try {
    src = await fss.readFile(file, &quot;utf8&quot;);
  } catch (err) {
    console.log(err);
    return &quot;Error reading file &quot; + file;
  }

  if (appEnv.source === &quot;cas&quot;) {
    let r = await caslRun(store, session, src, {}, true);
    return JSON.stringify(r.results);
  } else {
    let computeSummary = await computeRun(store, session, src);
    let log = await computeResults(store, computeSummary, &quot;log&quot;);
    return logAsArray(log);
  }
}
// setup configuration
let config = {
  provider: 'openai', 
  model: 'gpt-4-turbo-review', 
  credentials: {
    key: process.env.OPENAI_KEY, // for security get it from environment
    endPoint: null
  },
  assistantid: '0', //let system create a new assistant
  assistantName: &quot;SAS_ASSISTANT&quot;,

  threadid: '0', // let system create a new thread

  
  domainTools: {tools: tools, functionList: functionList, instructions: '', replace: false},
  code:  true,
  retrievel: true

  viyaConfig: {
    logonPayload: {
      authType: 'server',
      host: host,  // viya url - https://myviyaserver.acme.com
      token: token,// viya token | null
      tokenType: 'bearer'// if token is specified
      },
    source: 'cas' 
  }  
}

// run a chat session
chat(config)
  .then((r) => console.log('done'))
  .catch((err) => console.log(err));

async function chat(config) {
  //Setup assistant
  let gptControl = await setupAssistant(config);

  // create readline interface and chat with user
  const rl = readline.createInterface({ input, output });

  // process user input in a loop
  while (true) {
    let prompt = await rl.question('>');
    // exit session
    if (prompt.toLowerCase() === 'exit' || prompt.toLowerCase() === 'quit') {
      rl.close();
      break;
    }
    // let assistant process the prompt
    let promptInstructions = ' ';
    try {
      // run prompt
      let response = await runAssistant(gptControl, prompt,promptInstructions);
      console.log(response);
    } catch (err) {
      console.log(err);
    }
  }
}

</code></pre>
<h2>Step 3: Run the sample app</h2>
<pre class="prettyprint source lang-cmd"><code>node assistant
</code></pre>
<p>If source was set to 'cas' or 'compute' you can issue prompts that will use the
builtin tools. (see the main doc for the default tools). By default you can ask for list of
several Viya assets:</p>
<ul>
<li>list of reports, libraries (caslib or librefs
<ul>
<li>list reports</li>
<li>list libs</li>
</ul>
</li>
<li>for a given libref or caslib get list of tables
<ul>
<li>list tables in public</li>
<li>list tables in sashelp</li>
</ul>
</li>
<li>fetch data from a specified lib and table
<ul>
<li>get data for public.cars. limit to 20</li>
</ul>
</li>
</ul>
<h2>Peak ahead</h2>
<p>In the next example will discuss how to add your own tools.</p>
</article>

</section>

            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>