{"version":3,"file":"index.umd.js","sources":["../src/loadThread.js","../src/getLatestMessage.js","../src/pollRun.js","../src/required_action.js","../src/closeAssistant.js","../src/getMessages.js","../src/runAssistant.js","../src/setupAssistant.js","../src/createAssistant.js","../src/openAssistant.js"],"sourcesContent":["/*\r\n * Copyright © 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n/**\r\n * @async\r\n * @function loadThread\r\n * @description   reattach thread from previous session\r\n * @param {string} apiKey - openai api key\r\n * @param {string} threadid - thread id\r\n * @param {string} assistant - assistant object\r\n * @returns {promise} - return {thread, assistant}\r\n */\r\nasync function loadThread(openai, threadid, assistant, reuseThread) {\r\n // let thread_id = assistant.metadata.thread_id;\r\n\r\n  let thread = null;\r\n  // If we are reusing the thread, try to retrieve it\r\n  if (reuseThread === true && threadid != '0') {\r\n    try {\r\n      thread = await openai.beta.threads.retrieve(threadid);\r\n    } catch (error) {\r\n      console.log(error); \r\n      console.log(error.status);\r\n      console.log(`Error status ${error.status}. Unable to retrieve the thread ${thread_id}`);\r\n    }\r\n  }\r\n\r\n  // If still no thread, create a new one\r\n  if (thread == null) {\r\n    console.log('Creating new thread' );\r\n    thread = await openai.beta.threads.create({\r\n      metadata: { assistanceName: assistant.name },\r\n    });\r\n    // update assistant metadata\r\n    assistant = await openai.beta.assistants.update(assistant.id, {\r\n      metadata: { thread_id: thread.id, lastRunId: \"0\" },\r\n    });\r\n  }\r\n\r\n  return { thread, assistant };\r\n}\r\nexport default loadThread;\r\n","/*\r\n * Copyright © 2024, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n/**\r\n * \r\n * @description Return the latest message from thread\r\n * @param {object}  gptControl- openai control object\r\n * @param {number} limit - limit the number of messages to return\r\n * @returns {array} - messages - array of latest assistant messages[ {id, role, type, content}]\r\n * @notes - This function will return latest assistant messages based on limit\r\n */\r\nasync function getLatestMessage(gptControl, limit) {  \r\n  let {openai, thread} = gptControl;\r\n  const messages = await openai.beta.threads.messages.list(thread.id, {limit:limit});\r\n  //console.log('body', JSON.stringify(messages.body.data, null, 4));\r\n  let output = [];\r\n  let data = messages.data;\r\n  for (let i = 0; i < messages.data.length; i++){\r\n    let content = data[i].content[0];\r\n  \r\n    if (data[i].role === 'assistant') {\r\n      output.push({id: data[i].id, role: data[i].role, type: content.type, content: content[content.type].value});\r\n    } else {\r\n      break;\r\n    }\r\n  }\r\n  if (output.length > 1) {\r\n    output = output.reverse();\r\n  }\r\n  return output;\r\n\r\n}\r\nexport default getLatestMessage;","\r\n/*\r\n * Copyright © 2024, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * @async\r\n * @description - Poll run status since there is no streaming support\r\n * @function pollRun\r\n * @params {object} openai - openai object\r\n * @params {object} thread - thread object\r\n * @params {object} run - run object    \r\n * @params {object} gptControl - gpt  session control object\r\n * @returns {object} - runStatus from openai.beta.threads.runs.retrieve\r\n * @notes - Will wait for completion(!(queued,in_progress, cancelling))\r\n */\r\nasync function pollRun(thread, run, gptControl) {\r\n  let { openai, assistant} = gptControl;\r\n  let done = null;\r\n  let runStatus = null;\r\n  function sleep(ms) {\r\n    return new Promise((resolve) => setTimeout(resolve, ms));\r\n  }\r\n  // Since there is no streaming support, sleep and poll the status\r\n  do {\r\n    \r\n    runStatus = await openai.beta.threads.runs.retrieve(thread.id, run.id);\r\n    \r\n    console.log(\"-------------------\", runStatus.status);\r\n    if (\r\n      !(\r\n        runStatus.status === \"queued\" ||\r\n        runStatus.status === \"in_progress\" ||\r\n        runStatus.status === \"cancelling\"\r\n      )\r\n    ) {\r\n      done = runStatus.status;\r\n    } else {\r\n      await sleep(2000);\r\n      // console.log(\"waited 2000 ms\");\r\n    }\r\n  } while (done === null);\r\n\r\n  let newAssistant = await openai.beta.assistants.update(assistant.id, {\r\n    metadata: { thread_id: thread.id, lastRunId: run.id} \r\n  });\r\n  gptControl.assistant = newAssistant;\r\n  return runStatus;\r\n\r\n}\r\nexport default pollRun;","\r\n/*\r\n * Copyright © 2024, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n\r\n/**\r\n * @async\r\n * @description - Handle required actions for Assistant\r\n * @function required_action\r\n * @param {object} runStatus - run status object\r\n * @param {object} thread - thread object\r\n * @param {object} run - run object\r\n * @param {object} gptControl - gpt  session control object\r\n * @param {object} appEnv - Viya session control object(has store, sessionID, etc. to talk to Viya server)\r\n * @returns {*} - status from submitToolOutputs\r\n */\r\nimport pollRun from \"./pollRun.js\";\r\nasync function required_action(runStatus, thread, run,  gptControl, appEnv) {\r\n  let{openai,specs} = gptControl;\r\n  let {functionList} = specs;\r\n  \r\n  let requiredActions = runStatus.required_action.submit_tool_outputs.tool_calls;\r\n  \r\n  let toolsOutput = [];\r\n  for (let action of requiredActions) {\r\n    let functionName = action.function.name;\r\n    console.log('Requested function: ', functionName);\r\n    let params = JSON.parse(action.function.arguments);\r\n    let response = await functionList[functionName](params, appEnv, gptControl);\r\n\r\n    toolsOutput.push({\r\n      tool_call_id: action.id,\r\n      output: JSON.stringify(response),\r\n    });\r\n }\r\n// submit the outputs to the thread\r\n let newRun = await openai.beta.threads.runs.submitToolOutputs(\r\n  thread.id, run.id, { tool_outputs: toolsOutput });\r\n\r\n// wait for output to appear in the thread messages\r\n let outputStatus = await pollRun(thread, newRun, gptControl);\r\n\r\nreturn outputStatus;\r\n}\r\nexport default required_action;","/*\r\n * Copyright © 2024, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n/**\r\n * @async\r\n * @description - Close Viya connections.\r\n * @function closeAssistant\r\n * @param {object} gptControl - gpt session control object\r\n * @param {object} appEnv - Viya session control object(has store, sessionID, etc. to talk to Viya server)\r\n * @returns {boolean} - true\r\n */\r\nasync function closeAssistant(_gptControl, _appEnv) {\r\n  console.log('in closeAssistant');\r\n  return true;\r\n}\r\nexport default closeAssistant;","/*\r\n * Copyright © 2024, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n/**\r\n * \r\n * @description Return sepcified number of messages from thread\r\n * @param {object}  gptControl- openai control object\r\n * @param {number} limit - limit the number of messages to return\r\n * @returns {*} - messages - array of messages[ {id, role, type, content}]\r\n * @notes - This function will return the specified number of messages from the thread\r\n * Typically the top 2 will be the assistant message and user's prompt\r\n */\r\nasync function getMessages(gptControl, limit) {  \r\n  let {openai, thread} = gptControl;\r\n  const messages = await openai.beta.threads.messages.list(thread.id, {limit:limit});\r\n  //console.log('body', JSON.stringify(messages.body.data, null, 4));\r\n  let output = messages.data.map((m) => {\r\n    let content = m.content[0];\r\n    return {id: m.id, role: m.role, type: content.type, content: content[content.type].value};\r\n  });\r\n  return output;\r\n\r\n}\r\nexport default getMessages;","/*\r\n * Copyright © 2024, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\nimport getLatestMessage from \"./getLatestMessage.js\";\r\nimport required_action from \"./required_action.js\";\r\nimport pollRun from \"./pollRun.js\";\r\n\r\n/**\r\n * @async\r\n * @description - Run the latest prompt from the user\r\n * @function runAssistant\r\n * @param {string} prompt - User prompt\r\n * @param {object} gptControl - gpt  session control object\r\n * @param {object} appEnv - application info - ex: Viya session control object(has store, sessionID, etc. to talk to Viya server)\r\n * @param {string} instructions - Additional instructions for the run\r\n * @returns {*} - response from GPT(can be text, string, html etc...)\r\n * @notes - This function will run the assistant with the prompt and return the response from the assistant.\r\n */\r\n\r\nasync function runAssistant(prompt, gptControl, appEnv, instructions) {\r\n  let { openai, assistant, thread, specs } = gptControl;\r\n//  let {functionList} = specs;\r\n\r\n  //add the user request to thread\r\n  let run = null;\r\n  let newMessage = null;\r\n  try {\r\n    newMessage = await openai.beta.threads.messages.create(thread.id, {\r\n      role: \"user\",\r\n      content: prompt,\r\n    });\r\n  } catch (error) {\r\n    //tbd: recovery?\r\n    console.log(`status = ${error.status}. Unable to add the prompt to the thread`);\r\n    console.log('will try to cancel the last run');\r\n    return {status: error.status, message: error};\r\n  }\r\n  \r\n  let runArgs = {\r\n    assistant_id: assistant.id,\r\n    instructions: (instructions != null) ? instructions : ''\r\n  };\r\n\r\n  run = await openai.beta.threads.runs.create(thread.id, runArgs);\r\n\r\n  // Poll and wait for the run to complete\r\n  let runStatus = await pollRun(thread, run, gptControl);\r\n  \r\n  if (runStatus.status === \"completed\") {\r\n    \r\n    const message = await getLatestMessage (gptControl, 1); \r\n    return message;\r\n  } else if (runStatus.status === 'requires_action') {\r\n    let r = await required_action(\r\n      runStatus,\r\n      thread,\r\n      run,\r\n      gptControl,\r\n      appEnv\r\n    );\r\n    let message = await getLatestMessage(gptControl, 5);\r\n    return message;\r\n  } else {\r\n    return { runStatus: runStatus.status };\r\n  }\r\n}\r\nexport default runAssistant;\r\n\r\n//https://platform.openai.com/docs/guides/text-generation/chat-completions-api\r\n","/*\r\n* Copyright © 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n* SPDX-License-Identifier: Apache-2.0\r\n*/\r\n/**\r\n * @async\r\n * @function setupAssist\r\n * @description   Setup the GPT Assistant\r\n * @param {string} provider - azure or openai\r\n * @param {string} assistanceName - name of the assistant(default is SAS_Assistant)\r\n * @returns {promise} - return {openai, assistant, thread, functionList}\r\n */\r\nimport OpenAI from 'openai';  \r\nimport  {OpenAIClient, OpenAIKeyCredential} from '@azure/openai'\r\n\r\nimport createAssistant from './createAssistant.js';\r\nimport openAssistant from './openAssistant.js';\r\n\r\nasync function setupAssistant(config) {\r\n\r\n  // azureai open includes url and key\r\n  // the azureai is not supported yet.\r\n  // openai includes key\r\n  let {provider, assistantName, credentials} = config;\r\n // let apiKey = (provider === 'openai') ? process.env.OPENAI_KEY : process.env.OPENAI_AZ_KEY;\r\n  let apiKey = (provider === 'openai') ? credentials.openaiKey : credentials.azureaiKey;\r\n  let endpoint = credentials.azureaiEndpoint;\r\n  console.log(apiKey);\r\n  let openai = (provider === 'openai') ? new OpenAI({ apiKey: apiKey,  dangerouslyAllowBrowser: true }) : \r\n        new OpenAIClient(endpoint, new OpenAIKeyCredential(apiKey));\r\n\r\n // Wishlist: Wish could open with query of name and let it succeed or fail\r\n  const myAssistants = await openai.beta.assistants.list({\r\n    order: \"desc\",\r\n    limit: \"100\",\r\n  });\r\n  let assistant = myAssistants.data.find((a) => { \r\n    if (a.name === assistantName) {\r\n      return a;\r\n    }\r\n  });\r\n\r\n  // Either create a new assistant or reuse the existing one(preferred)\r\n  let gptControl = (assistant == null) \r\n                     ? await createAssistant(openai, config)\r\n                     : await openAssistant(openai, assistant, config);\r\n  return gptControl; \r\n\r\n  }\r\n  export default setupAssistant;","/*\r\n* Copyright © 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n* SPDX-License-Identifier: Apache-2.0\r\n*/\r\n\r\nimport loadThread from \"./loadThread.js\";\r\n\r\n/**\r\n * @async\r\n * @function setupAssist\r\n * @description   Setup the GPT Assistant\r\n * @param {string} apiKey - openai api key\r\n * @param {object} config - configuration object\r\n * @returns {promise} - return gptControl{openai, assistant, thread, threadid, functions specs}\r\n */\r\nasync function createAssistant(openai, config) {\r\nlet {assistantName, instructions, model, specs, reuseThread} = config;\r\nlet createArgs = {\r\n  name: assistantName,\r\n  instructions: instructions,\r\n  model: model, \r\n  metadata:{ thread_id: '0', lastRunId: '0'},\r\n};\r\nif (specs.tools != null ){\r\n  createArgs.tools = specs.tools;\r\n}\r\n\r\nlet assistant = await openai.beta.assistants.create(createArgs);\r\nconsole.log('-----------------------------------');\r\nconsole.log('New Assistant: ', assistantName , assistant.id);\r\nlet r = await loadThread(openai, config.threadid, assistant, reuseThread);\r\nconsole.log('Thread ID: ', r.thread.id);\r\nconsole.log('-----------------------------------');\r\n// assistant might have been updated in loadThread\r\nlet gptControl = {\r\n  openai,\r\n  assistant: r.assistant, \r\n  thread: r.thread,\r\n  threadid: r.thread.id,\r\n specs};\r\nreturn gptControl;\r\n}\r\nexport default createAssistant;","/*\r\n * Copyright © 2019, SAS Institute Inc., Cary, NC, USA.  All Rights Reserved.\r\n * SPDX-License-Identifier: Apache-2.0\r\n */\r\n/**\r\n * @async\r\n * @function openAssistant\r\n * @description   Reuse existing assistant\r\n * @param {string} apiKey - openai api key\r\n * @param {string} assistant - assistant object\r\n * @param {object} config - configuration object\r\n * @returns {promise} - return {openai, assistant, thread, threadid, function specs}\r\n */\r\nimport loadThread from './loadThread.js'; \r\nasync function openAssistant(openai, assistant, config) {\r\n\r\n  let {reuseThread} = config;\r\n  console.log(\"Using Existing Assistant: \", assistant.name, assistant.id);\r\n  let thread_id = assistant.metadata.thread_id;\r\n\r\n  if (config.threadid !== '0') {\r\n    thread_id = config.threadid;\r\n  }\r\n\r\n  console.log(\"Associated thread_id: \", thread_id);\r\n\r\n  // load previous thread. loadThread will create a new thread if reuseThread is false\r\n  let r = await loadThread(openai, thread_id, assistant, reuseThread);\r\n  // assistant might have been updated in loadThread\r\n  let gptControl = {\r\n    openai: openai,\r\n    assistant: r.assistant,\r\n    thread: r.thread,\r\n    threadid: r.thread.id,\r\n    specs: config.specs\r\n  };\r\n  return gptControl;\r\n}\r\nexport default openAssistant;"],"names":["loadThread","openai","threadid","assistant","reuseThread","_temp5","_temp3","thread","_temp2","console","log","Promise","resolve","beta","threads","create","metadata","assistanceName","name","then","_openai$beta$threads$2","assistants","update","id","thread_id","lastRunId","_openai$beta$assistan","_temp4","_temp","body","recover","result","retrieve","_openai$beta$threads$","e","_catch","error","status","reject","getLatestMessage","gptControl","limit","messages","list","output","data","i","length","content","role","push","type","value","reverse","_settle","pact","state","s","_Pact","o","bind","v","observer","pollRun","run","newAssistant","runStatus","done","test","awaitBody","_isSettledPact","shouldContinue","_resumeAfterBody","_resumeAfterTest","_do","runs","setTimeout","prototype","onFulfilled","onRejected","this","callback","_this","thenable","_iteratorSymbol","Symbol","iterator","_gptControl","_appEnv","map","m","prompt","appEnv","instructions","_exit","_result","assistant_id","submitToolOutputs","tool_outputs","toolsOutput","newRun","functionList","specs","target","check","step","_cycle","next","return","_fixup","TypeError","values","array","_forTo","_forOf","required_action","submit_tool_outputs","tool_calls","action","functionName","params","JSON","parse","arguments","response","tool_call_id","stringify","r","message","config","provider","assistantName","credentials","apiKey","openaiKey","azureaiKey","endpoint","azureaiEndpoint","OpenAI","dangerouslyAllowBrowser","OpenAIClient","OpenAIKeyCredential","order","myAssistants","find","a","createArgs","model","tools","createAssistant","openAssistant"],"mappings":"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"}